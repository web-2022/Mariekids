<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8" />
        <title>Marie Kids ‚Ä¢ Ajedrez ‚Ä¢ Mate en 1</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- PWA -->
        <link rel="manifest" href="manifest.json">
        <meta name="theme-color" content="#1976d2">

        <style>
            * {
                box-sizing: border-box;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            }

            /* ======= MEN√ö (igual al otro) ======= */
            .nav {
                display: flex;
                gap: 10px;
                background: #eff6ff;
                border: 1px solid #bfdbfe;
                padding: 10px;
                border-radius: 18px;
                margin-bottom: 14px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-btn {
                display: inline-block;
                text-decoration: none;
                border: 1px solid #bfdbfe;
                background: #ffffff;
                border-radius: 999px;
                padding: 8px 12px;
                cursor: pointer;
                font-weight: 800;
                font-size: 0.95rem;
                transition: transform 0.1s ease, background 0.15s ease, border-color 0.15s ease, opacity 0.1s ease;
                min-width: 120px;
                text-align: center;
                color: #111827;
            }

            .nav-btn:hover {
                transform: translateY(-1px);
                background: #e0f2fe;
                border-color: #93c5fd;
            }

            .nav-btn.active {
                background: linear-gradient(90deg, #60a5fa, #2563eb);
                color: #fff;
                border-color: transparent;
            }


            body {
                margin: 0;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background: linear-gradient(145deg, #dbeafe, #e0f2fe);
                padding: 14px;
            }

            .app {
                background: #ffffff;
                width: 100%;
                max-width: 540px;
                padding: 24px;
                border-radius: 24px;
                box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
                border: 3px solid #2563eb;
            }

            /* üåü Encabezado infantil Marie Kids (burbujas + estrellas) */
            .brand-header-kids {
                position: relative;
                overflow: hidden;
                padding: 14px 14px 12px;
                border-radius: 22px;
                margin-bottom: 12px;

                background: linear-gradient(135deg, #93c5fd, #60a5fa, #2563eb);
                border: 2px solid rgba(255, 255, 255, 0.65);
                box-shadow: 0 14px 28px rgba(37, 99, 235, 0.25);
                color: #fff;
            }

            .brand-row {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .kids-badge {
                width: 52px;
                height: 52px;
                border-radius: 18px;
                display: grid;
                place-items: center;
                font-size: 1.55rem;

                background: rgba(255, 255, 255, 0.22);
                border: 1px solid rgba(255, 255, 255, 0.35);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.35);
            }

            .kids-title {
                font-weight: 950;
                font-size: 1.55rem;
                letter-spacing: 0.02em;
                line-height: 1.05;
                text-shadow: 0 2px 0 rgba(0, 0, 0, 0.12);
            }

            .kids-subtitle {
                margin-top: 4px;
                font-size: 0.9rem;
                font-weight: 750;
                opacity: 0.95;
                display: flex;
                align-items: center;
                gap: 8px;
                flex-wrap: wrap;
            }

            .kids-pill {
                background: rgba(255, 255, 255, 0.22);
                border: 1px solid rgba(255, 255, 255, 0.35);
                padding: 4px 10px;
                border-radius: 999px;
                font-size: 0.82rem;
                font-weight: 850;
            }

            /* ‚≠ê Estrellitas flotando */
            .star {
                position: absolute;
                opacity: 0.9;
                filter: drop-shadow(0 2px 0 rgba(0, 0, 0, 0.12));
                animation: twinkle 2.8s ease-in-out infinite;
                pointer-events: none;
            }

            .star.s1 {
                top: 8px;
                right: 18px;
                font-size: 1.15rem;
                animation-delay: 0s;
            }

            .star.s2 {
                top: 40px;
                right: 60px;
                font-size: 0.95rem;
                animation-delay: .6s;
            }

            .star.s3 {
                bottom: 12px;
                right: 26px;
                font-size: 1.25rem;
                animation-delay: 1.1s;
            }

            /* ü´ß Burbujas */
            .bubble {
                position: absolute;
                width: 64px;
                height: 64px;
                border-radius: 999px;
                background: rgba(255, 255, 255, 0.22);
                border: 1px solid rgba(255, 255, 255, 0.28);
                box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.45);
                backdrop-filter: blur(2px);
                pointer-events: none;
                animation: floaty 6s ease-in-out infinite;
            }

            .b1 {
                left: -16px;
                top: -18px;
                animation-delay: 0s;
                transform: rotate(5deg);
            }

            .b2 {
                left: 40px;
                bottom: -22px;
                width: 52px;
                height: 52px;
                animation-delay: .8s;
            }

            .b3 {
                right: -22px;
                bottom: -26px;
                width: 76px;
                height: 76px;
                animation-delay: 1.3s;
            }

            @keyframes floaty {

                0%,
                100% {
                    transform: translateY(0) scale(1);
                }

                50% {
                    transform: translateY(-8px) scale(1.03);
                }
            }

            @keyframes twinkle {

                0%,
                100% {
                    transform: scale(1) rotate(0deg);
                    opacity: 0.9;
                }

                50% {
                    transform: scale(1.12) rotate(6deg);
                    opacity: 1;
                }
            }

            h1 {
                margin: 0 0 4px 0;
                text-align: center;
                font-size: 1.45rem;
            }

            .subtitle {
                text-align: center;
                font-size: 0.9rem;
                color: #6b7280;
                margin-bottom: 14px;
            }

            /* Barra Correctas / Por mejorar */
            .status-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                padding: 8px 12px;
                border-radius: 999px;
                background: #eff6ff;
                border: 1px solid #bfdbfe;
                font-size: 0.9rem;
            }

            .xp,
            .hearts {
                display: flex;
                align-items: center;
                gap: 4px;
                font-weight: 700;
            }

            .xp span {
                color: #16a34a;
            }

            .hearts span {
                color: #f97316;
            }

            /* Barra de progreso */
            .progress-wrapper {
                margin-bottom: 14px;
            }

            .progress-label {
                display: flex;
                justify-content: space-between;
                font-size: 0.8rem;
                color: #6b7280;
                margin-bottom: 4px;
            }

            .progress {
                width: 100%;
                height: 10px;
                background: #e5e7eb;
                border-radius: 999px;
                overflow: hidden;
            }

            .progress-inner {
                height: 100%;
                width: 0%;
                border-radius: 999px;
                background: linear-gradient(90deg, #60a5fa, #2563eb);
                transition: width 0.2s ease;
            }

            .card {
                border-radius: 20px;
                padding: 18px;
                background: #f9fafb;
                border: 1px solid #e5e7eb;
                margin-bottom: 16px;
                transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
            }

            .card.correct {
                animation: pulse 0.4s ease;
                border-color: #2563eb;
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
            }

            .card.wrong {
                animation: shake 0.3s ease;
                border-color: #ef4444;
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }

                50% {
                    transform: scale(1.03);
                }

                100% {
                    transform: scale(1);
                }
            }

            @keyframes shake {

                0%,
                100% {
                    transform: translateX(0);
                }

                20% {
                    transform: translateX(-4px);
                }

                40% {
                    transform: translateX(4px);
                }

                60% {
                    transform: translateX(-4px);
                }

                80% {
                    transform: translateX(4px);
                }
            }

            /* ======= Ajedrez ======= */

            .board-section {
                margin-top: 10px;
            }

            .goal-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
                margin-bottom: 8px;
            }

            .goal {
                font-weight: 900;
                font-size: 1.02rem;
                color: #111827;
            }

            .speak-btn {
                font-size: 1.15rem;
                cursor: pointer;
                background: #eff6ff;
                border-radius: 999px;
                border: 1px solid #bfdbfe;
                padding: 6px 10px;
                transition: transform 0.1s ease, background 0.15s ease, border-color 0.15s ease;
            }

            .speak-btn:hover {
                transform: scale(1.06);
                background: #dbeafe;
                border-color: #93c5fd;
            }

            /* ‚úÖ Marco para coordenadas al borde */
            .board-wrap {
                display: flex;
                justify-content: center;
                margin: 8px 0 6px;
            }

            .board-frame {
                position: relative;
                width: 100%;
                max-width: 90vw;
            }

            .board {
                width: 100%;
                aspect-ratio: 1/1;
                border-radius: 15px;
                overflow: hidden;
                border: 2px solid #93c5fd;
                box-shadow: 0 10px 22px rgba(0, 0, 0, 0.08);
                display: grid;
                grid-template-columns: repeat(8, 1fr);
            }

            .sq {
                aspect-ratio: 1 / 1;
                /* üîí cada casilla es cuadrada */
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.6rem;
                /* piezas grandes */
                line-height: 1;
            }

            .light {
                background: #f0f9ff;
            }

            .dark {
                background: #93c5fd;
            }

            /* ‚úÖ Coordenadas fuera del tablero (borde) */
            .file-labels {
                position: absolute;
                left: 0;
                right: 0;
                bottom: -22px;
                display: grid;
                grid-template-columns: repeat(8, 1fr);
                text-align: center;
                font-size: 0.95rem;
                font-weight: 900;
                color: #1f2937;
                opacity: 0.85;
                pointer-events: none;
            }

            .rank-labels {
                position: absolute;
                top: 0;
                bottom: 0;
                left: -22px;
                display: grid;
                grid-template-rows: repeat(8, 1fr);
                align-items: center;
                justify-items: center;
                font-size: 0.95rem;
                font-weight: 900;
                color: #1f2937;
                opacity: 0.85;
                pointer-events: none;
            }

            .hint {
                text-align: center;
                font-size: 0.92rem;
                font-weight: 750;
                color: #374151;
                margin-top: 20px;
            }

            .mini {
                margin-top: 6px;
                text-align: center;
                font-size: 0.82rem;
                color: #6b7280;
                font-weight: 700;
            }

            code.k {
                background: #eef2ff;
                padding: 2px 6px;
                border-radius: 8px;
                font-weight: 900;
            }

            .options {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 12px;
            }

            .option-btn {
                flex: 1;
                min-width: 120px;
                border-radius: 14px;
                border: 1px solid #d1d5db;
                background: #ffffff;
                padding: 10px 10px;
                font-size: 0.95rem;
                cursor: pointer;
                transition: background 0.15s ease, transform 0.1s ease, border 0.1s ease, opacity 0.1s ease;
                font-weight: 900;
            }

            .option-btn:hover:not(:disabled) {
                background: #e0f2fe;
                transform: translateY(-1px);
                border-color: #93c5fd;
            }

            .option-btn:disabled {
                cursor: default;
                opacity: 0.6;
            }

            .feedback {
                margin-top: 10px;
                font-size: 0.95rem;
                text-align: center;
                min-height: 20px;
                font-weight: 900;
            }

            .feedback.good {
                color: #16a34a;
            }

            .feedback.bad {
                color: #ef4444;
            }

            .controls {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 10px;
            }

            button.main-btn {
                flex: 1;
                border: none;
                padding: 10px 12px;
                border-radius: 999px;
                font-size: 0.95rem;
                cursor: pointer;
                background: linear-gradient(90deg, #60a5fa, #2563eb);
                color: #ffffff;
                font-weight: 900;
                letter-spacing: 0.02em;
                transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.15s ease;
                min-width: 120px;
            }

            button.main-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
                filter: brightness(1.05);
            }

            /* ‚úÖ MENSAJE FINAL BONITO */
            .final-message {
                display: none;
                margin-top: 14px;
                padding: 14px;
                border-radius: 16px;
                background: linear-gradient(145deg, #ecfeff, #dbeafe);
                border: 2px solid #93c5fd;
                text-align: center;
                font-size: 1rem;
                font-weight: 900;
                color: #1e3a8a;
            }

            .final-message span {
                display: block;
                margin-top: 6px;
                font-size: 0.9rem;
                font-weight: 800;
                color: #1f2937;
            }



            /* Ajustes en pantallas peque√±as */
            @media (max-width: 420px) {
                .sq {
                    font-size: 2.7rem;
                }

                .board-frame {
                    max-width: 360px;
                }

                .file-labels {
                    bottom: -20px;
                    font-size: 0.92rem;
                }

                .rank-labels {
                    left: -20px;
                    font-size: 0.92rem;
                }
            }
        </style>
    </head>

    <body>
        <div class="app">
            <nav class="nav" aria-label="Cursos">
                <a class="nav-btn" href="index.html">üá∫üá∏ Ingl√©s</a>
                <a class="nav-btn active" href="ajedrez.html">‚ôüÔ∏è Ajedrez</a>
                <a class="nav-btn" href="#">‚ûó Matem√°ticas</a>
            </nav>


            <!-- üåü Encabezado infantil: Marie Kids -->
            <div class="brand-header-kids" aria-label="Marie Kids">
                <div class="bubble b1"></div>
                <div class="bubble b2"></div>
                <div class="bubble b3"></div>

                <div class="star s1">‚≠ê</div>
                <div class="star s2">‚ú®</div>
                <div class="star s3">üåü</div>

                <div class="brand-row">
                    <div class="kids-badge" aria-hidden="true">‚ôüÔ∏è</div>
                    <div>
                        <div class="kids-title">Marie Kids</div>
                        <div class="kids-subtitle">
                            Ajedrez divertido
                            <span class="kids-pill">Mate en 1</span>
                            <span class="kids-pill">‚≠ê T√°cticas</span>
                        </div>
                    </div>
                </div>
            </div>

            <h1>Ajedrez ‚Ä¢ Mate en 1</h1>
            <p class="subtitle">Mira el tablero y elige la jugada correcta: <b>blancas dan mate en 1</b>.</p>

            <!-- Barra de estado -->
            <div class="status-bar">
                <div class="xp">‚úÖ Correctas: <span id="xpValue">0</span></div>
                <div class="hearts">üß† Por mejorar: <span id="heartsValue">0</span></div>
            </div>

            <!-- Barra de progreso -->
            <div class="progress-wrapper">
                <div class="progress-label">
                    <span>Progreso de la sesi√≥n</span>
                    <span id="progressText">0/10</span>
                </div>
                <div class="progress">
                    <div class="progress-inner" id="progressBar"></div>
                </div>
            </div>

            <!-- Tarjeta principal -->
            <div class="card" id="lessonCard">

                <div class="goal-row">
                    <div class="goal" id="goalText">Juegan blancas y dan mate en 1</div>
                    <button class="speak-btn" type="button" onclick="speakPrompt()">üîä</button>
                </div>

                <div class="board-section">
                    <div class="board-wrap">
                        <div class="board-frame">
                            <div class="rank-labels" id="rankLabels"></div>
                            <div class="board" id="board"></div>
                            <div class="file-labels" id="fileLabels"></div>
                        </div>
                    </div>

                    <div class="hint" id="hintText">Encuentra el jaque mate en una jugada.</div>
                    <div class="mini">Formato: <code class="k">Qh7#</code> (pieza + casilla + #)</div>
                </div>

                <div class="options" id="optionsContainer"></div>

                <div class="feedback" id="feedback"></div>

                <!-- ‚úÖ MENSAJE FINAL -->
                <div class="final-message" id="finalMessage"></div>
            </div>

            <div class="controls">
                <button class="main-btn" type="button" onclick="nextLesson()">Next</button>
            </div>

        </div>

        <script>
            /* ========= Datos: Problemas Mate en 1 =========
               Tablero 8x8 como texto (rango 8 -> 1), '.' = vac√≠o.
               Piezas con emojis:
               Blancas: ‚ôî‚ôï‚ôñ‚ôó‚ôò‚ôô
               Negras:  ‚ôö‚ôõ‚ôú‚ôù‚ôû‚ôü
                K:"‚ôî", Q:"‚ôï", R:"‚ôñ", B:"‚ôó", N:"‚ôò", P:"‚ôô",
                k:"‚ôö", q:"‚ôõ", r:"‚ôú", b:"‚ôù", n:"‚ôû", p:"‚ôü"
            */

            const puzzles = [
                // 1) DAMA: Qg7#
                {
                    id: 1,
                    hint: "Mate con la dama cerca del rey.",
                    board: [
                        ".......‚ôö", // 8  (rey negro h8)
                        ".....‚ôï..", // 7  (dama blanca f7)
                        "......‚ôî.", // 6  (rey blanco g6 protege g7)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "........"  // 1
                    ],
                    moveCorrect: "Qg7#",
                    moves: ["Qg7#", "Qf8+", "Qh7+"]
                },

                // 2) DAMA: Qd8#
                {
                    id: 2,
                    hint: "La dama entra al fondo: busca el mate en la 8¬™ fila.",
                    board: [
                        "....‚ôö...", // 8  (rey negro e8)
                        "...‚ôï....", // 7  (dama blanca d7)
                        "....‚ôî...", // 6  (rey blanco e6)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "...‚ôñ...."  // 1  (torre blanca d1 protege d8)
                    ],
                    moveCorrect: "Qd8#",
                    moves: ["Qd8#", "Qe7+", "Qf7+"]
                },

                // 3) TORRE: Rh7#
                {
                    id: 3,
                    hint: "Mate cl√°sico de torre en la columna h.",
                    board: [
                        ".......‚ôö", // 8  (rey negro h8)
                        "........", // 7
                        "......‚ôî.", // 6  (rey blanco g6 protege h7)
                        "...‚ôó....", // 5  (alfil blanco d5 controla g8)
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        ".......‚ôñ"  // 1  (torre blanca h1)
                    ],
                    moveCorrect: "Rh7#",
                    moves: ["Rh7#", "Rh6+", "Rh5+"]
                },

                // 4) TORRE: Ra8#
                {
                    id: 4,
                    hint: "Encierra al rey en la esquina con la torre.",
                    board: [
                        "‚ôö.......", // 8  (rey negro a8)
                        ".‚ôó......", // 7  (alfil blanco b7 protege a8 y cubre diagonales)
                        "..‚ôî.....", // 6  (rey blanco c6)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "‚ôñ......."  // 1  (torre blanca a1)
                    ],
                    moveCorrect: "Ra8#",
                    moves: ["Ra8#", "Ra7+", "Ra6+"]
                },

                // 5) ALFIL: Bg7#
                {
                    id: 5,
                    hint: "El alfil da mate con ayuda de la dama.",
                    board: [
                        ".......‚ôö", // 8  (rey negro h8)
                        "........", // 7
                        "....‚ôî‚ôó‚ôï.", // 6  (rey e6, alfil f6, dama g6)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "........"  // 1
                    ],
                    moveCorrect: "Bg7#",
                    moves: ["Bg7#", "Qh7+", "Qf7+"]
                },

                // 6) ALFIL: Bb7#
                {
                    id: 6,
                    hint: "Mate de alfil en la esquina (apoyado por torre).",
                    board: [
                        "‚ôö.......", // 8  (rey negro a8)
                        "........", // 7
                        "..‚ôó.....", // 6  (alfil blanco c6)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "‚ôñ‚ôñ..‚ôî..."  // 1  (torres a1,b1; rey e1)
                    ],
                    moveCorrect: "Bb7#",
                    moves: ["Bb7#", "Be8+", "Bd7+"]
                },

                // 7) CABALLO: Nf7#
                {
                    id: 7,
                    hint: "Mate de caballo: el rey no puede bloquear un jaque de caballo.",
                    board: [
                        ".......‚ôö", // 8  (rey negro h8)
                        "......‚ôü‚ôü", // 7  (peones negros g7 h7 bloquean escapes)
                        "....‚ôî...", // 6  (rey blanco e6)
                        "...‚ôó..‚ôò.", // 5  (alfil d5 controla g8; caballo g5)
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "........"  // 1
                    ],
                    moveCorrect: "Nf7#",
                    moves: ["Nf7#", "Nh7+", "Ne6+"]
                },

                // 8) CABALLO: Ng6#
                {
                    id: 8,
                    hint: "El caballo salta y da mate, con el rey encerrado.",
                    board: [
                        ".......‚ôö", // 8  (rey negro h8)
                        ".....‚ôó‚ôü‚ôü", // 7  (alfil blanco f7; peones negros g7 h7)
                        ".....‚ôî..", // 6  (rey blanco f6)
                        "....‚ôò...", // 5  (caballo blanco e5)
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "........"  // 1
                    ],
                    moveCorrect: "Ng6#",
                    moves: ["Ng6#", "Nd7+", "Nf7+"]
                },

                // 9) PE√ìN: f7#  (pe√≥n avanza y da mate)
                {
                    id: 9,
                    hint: "Mate con pe√≥n: avance simple.",
                    board: [
                        "....‚ôö...", // 8  (rey negro e8)
                        "........", // 7
                        "....‚ôî‚ôô.‚ôó", // 6  (rey e6, pe√≥n f6, alfil h6 controla f8)
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "...‚ôñ...."  // 1  (torre d1 controla d8)
                    ],
                    moveCorrect: "f7#",
                    moves: ["f7#", "Rd8+", "Bg7"]
                },

                // 10) PE√ìN PROMOCI√ìN: g8=Q#
                {
                    id: 10,
                    hint: "Promoci√≥n con mate (elige la mejor promoci√≥n).",
                    board: [
                        "........", // 8
                        ".....‚ôî‚ôô‚ôö", // 7  (rey blanco f7, pe√≥n blanco g7, rey negro h7)
                        "........", // 6
                        "........", // 5
                        "........", // 4
                        "........", // 3
                        "........", // 2
                        "..‚ôó....."  // 1  (alfil c1 controla h6)
                    ],
                    moveCorrect: "g8=Q#",
                    moves: ["g8=Q#", "g8=R+", "g8=N+"]
                }
            ];

            let currentPuzzle = null;

            // Correctas / Por mejorar
            let correctCount = 0;
            let wrongCount = 0;

            // Para controlar que solo se cuente 1 vez la correcta por tarjeta
            let answeredCorrectly = false;

            // progreso por sesi√≥n
            let progress = 0;
            const maxProgress = 10;

            const correctSpan = document.getElementById("xpValue");
            const wrongSpan = document.getElementById("heartsValue");
            const feedbackEl = document.getElementById("feedback");
            const lessonCard = document.getElementById("lessonCard");

            const progressBar = document.getElementById("progressBar");
            const progressText = document.getElementById("progressText");

            const boardEl = document.getElementById("board");
            const hintEl = document.getElementById("hintText");

            function updateProgressBar() {
                const percent = (progress / maxProgress) * 100;
                progressBar.style.width = percent + "%";
                progressText.textContent = `${progress}/${maxProgress}`;
            }

            function randomFromArray(arr) {
                return arr[Math.floor(Math.random() * arr.length)];
            }

            function shuffleArray(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
            }

            function pickPuzzle() {
                return randomFromArray(puzzles);
            }

            // ‚úÖ Coordenadas al borde
            function renderCoords() {
                const fileEl = document.getElementById("fileLabels");
                const rankEl = document.getElementById("rankLabels");

                const files = ["a", "b", "c", "d", "e", "f", "g", "h"];
                fileEl.innerHTML = files.map(f => `<div>${f}</div>`).join("");

                const ranks = ["8", "7", "6", "5", "4", "3", "2", "1"];
                rankEl.innerHTML = ranks.map(r => `<div>${r}</div>`).join("");
            }

            function renderBoard(boardRows) {
                boardEl.innerHTML = "";

                for (let r = 0; r < 8; r++) {
                    const row = boardRows[r];
                    for (let c = 0; c < 8; c++) {
                        const sq = document.createElement("div");
                        const isDark = (r + c) % 2 === 1;
                        sq.className = "sq " + (isDark ? "dark" : "light");

                        const ch = row[c];
                        sq.textContent = (ch === ".") ? "" : ch;

                        boardEl.appendChild(sq);
                    }
                }

                renderCoords();
            }

            function createOptions() {
                const container = document.getElementById("optionsContainer");
                container.innerHTML = "";

                const opts = [...currentPuzzle.moves];
                shuffleArray(opts);

                opts.forEach(move => {
                    const btn = document.createElement("button");
                    btn.type = "button";
                    btn.textContent = move;
                    btn.className = "option-btn";
                    btn.onclick = () => checkAnswer(move, btn);
                    container.appendChild(btn);
                });
            }

            function renderLesson() {
                answeredCorrectly = false;

                currentPuzzle = pickPuzzle();

                document.getElementById("goalText").textContent = "Juegan blancas y dan mate en 1";
                hintEl.textContent = currentPuzzle.hint;

                feedbackEl.textContent = "";
                feedbackEl.classList.remove("good", "bad");
                lessonCard.classList.remove("correct", "wrong");

                const finalBox = document.getElementById("finalMessage");
                finalBox.style.display = "none";
                finalBox.innerHTML = "";

                renderBoard(currentPuzzle.board);
                createOptions();
            }

            function speakText(text) {
                if (!("speechSynthesis" in window)) return;
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = "es-ES";
                utter.rate = 0.95;
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utter);
            }

            function speakPrompt() {
                if (!currentPuzzle) return;
                speakText("Juegan blancas y dan mate en una. " + currentPuzzle.hint);
            }

            function checkAnswer(answer, clickedBtn) {
                if (!currentPuzzle) return;

                // si ya se respondi√≥ correctamente esta tarjeta, no contar m√°s
                if (answeredCorrectly) return;

                if (answer === currentPuzzle.moveCorrect) {
                    answeredCorrectly = true;

                    correctCount++;
                    correctSpan.textContent = correctCount;

                    if (progress < maxProgress) {
                        progress += 1;
                        updateProgressBar();
                    }

                    feedbackEl.textContent = randomFromArray([
                        "‚úÖ ¬°Mate! Excelente.",
                        "‚úÖ ¬°Correcto! Gran jugada.",
                        "‚úÖ ¬°Muy bien! Jaque mate.",
                        "‚úÖ ¬°Perfecto! Mate en 1."
                    ]);
                    feedbackEl.classList.remove("bad");
                    feedbackEl.classList.add("good");

                    lessonCard.classList.remove("wrong");
                    lessonCard.classList.add("correct");

                    // deshabilitar todas las opciones despu√©s de acertar
                    document.querySelectorAll(".option-btn").forEach(b => { b.disabled = true; });

                    // ‚úÖ Mensaje final si complet√≥ la sesi√≥n
                    if (progress >= maxProgress) {
                        const finalBox = document.getElementById("finalMessage");
                        finalBox.innerHTML = `
            üéâ ¬°Sesi√≥n completada!<br>
            Lograste <strong>${correctCount}</strong> mates correctos.
            <span>¬°Sigue practicando! ‚ôüÔ∏è‚ú®</span>
          `;
                        finalBox.style.display = "block";
                        feedbackEl.textContent = "‚úÖ ¬°Sesi√≥n completa! Excelente trabajo.";
                        feedbackEl.classList.add("good");
                    }

                } else {
                    wrongCount++;
                    wrongSpan.textContent = wrongCount;

                    feedbackEl.textContent = "‚ùå No es mate. Intenta otra opci√≥n.";
                    feedbackEl.classList.remove("good");
                    feedbackEl.classList.add("bad");

                    lessonCard.classList.remove("correct");
                    lessonCard.classList.add("wrong");

                    // deshabilitamos solo este bot√≥n
                    if (clickedBtn) clickedBtn.disabled = true;
                }
            }

            function nextLesson() {
                renderLesson();
            }

            // Inicializar
            updateProgressBar();
            renderLesson();
        </script>

        <script>
            // Registrar Service Worker (PWA)
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker.register("./service-worker.js").catch(() => { });
                });
            }
        </script>
    </body>


</html>
