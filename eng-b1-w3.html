<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marie Kids ‚Ä¢ Comparatives & Superlatvies ‚Ä¢ 3 Niveles</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1976d2">
    <style>
        * {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, #dbeafe, #e0f2fe);
            padding: 18px;
        }

        .app {
            background: #ffffff;
            width: 100%;
            max-width: 520px;
            padding: 18px;
            border-radius: 24px;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
            border: 3px solid #2563eb;
        }

        /* üåü Encabezado infantil (ORIGINAL) */
        .brand-header-kids {
            position: relative;
            overflow: hidden;
            padding: 14px 14px 12px;
            border-radius: 22px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #93c5fd, #60a5fa, #2563eb);
            border: 2px solid rgba(255, 255, 255, .65);
            box-shadow: 0 14px 28px rgba(37, 99, 235, .25);
            color: #fff;
        }

        .brand-header-kids.clickable {
            cursor: pointer;
            user-select: none;
            transition: transform 0.12s ease, filter 0.12s ease, box-shadow 0.12s ease;
        }

        .brand-header-kids.clickable:hover {
            transform: translateY(-1px);
            filter: brightness(1.02);
            box-shadow: 0 18px 34px rgba(37, 99, 235, .28);
        }

        .brand-header-kids.clickable:active {
            transform: translateY(0px) scale(0.995);
        }

        .brand-header-kids .bubble,
        .brand-header-kids .star {
            pointer-events: none;
        }

        .brand-row {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .kids-badge {
            width: 52px;
            height: 52px;
            border-radius: 18px;
            display: grid;
            place-items: center;
            font-size: 1.55rem;
            background: rgba(255, 255, 255, .22);
            border: 1px solid rgba(255, 255, 255, .35);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, .35);
        }

        .kids-title {
            font-weight: 950;
            font-size: 1.55rem;
            letter-spacing: .02em;
            line-height: 1.05;
            text-shadow: 0 2px 0 rgba(0, 0, 0, .12);
        }

        .kids-subtitle {
            margin-top: 4px;
            font-size: .9rem;
            font-weight: 750;
            opacity: .95;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .kids-pill {
            background: rgba(255, 255, 255, .22);
            border: 1px solid rgba(255, 255, 255, .35);
            padding: 4px 10px;
            border-radius: 999px;
            font-size: .82rem;
            font-weight: 850;
        }

        .star {
            position: absolute;
            z-index: 1;
            opacity: .9;
            filter: drop-shadow(0 2px 0 rgba(0, 0, 0, .12));
            animation: twinkle 2.8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes twinkle {
            0%, 100% { transform: translateY(0) scale(1); opacity: .9; }
            50% { transform: translateY(-2px) scale(1.03); opacity: 1; }
        }

        .star.s1 { top: 8px; right: 18px; font-size: 1.15rem; animation-delay: 0s; }
        .star.s2 { top: 40px; right: 60px; font-size: .95rem; animation-delay: .6s; }
        .star.s3 { bottom: 12px; right: 26px; font-size: 1.25rem; animation-delay: 1.1s; }

        .bubble {
            position: absolute;
            z-index: 0;
            border-radius: 999px;
            background: rgba(255, 255, 255, .22);
            border: 1px solid rgba(255, 255, 255, .28);
            box-shadow: inset 0 2px 0 rgba(255, 255, 255, .45);
            pointer-events: none;
            -webkit-backdrop-filter: blur(2px);
            backdrop-filter: blur(2px);
            animation: floaty 6s ease-in-out infinite;
        }

        .b1 { left: -16px; top: -18px; width: 84px; height: 84px; animation-delay: 0s; transform: rotate(5deg); }
        .b2 { left: 40px; bottom: -22px; width: 52px; height: 52px; animation-delay: .8s; }
        .b3 { right: -22px; bottom: -26px; width: 76px; height: 76px; animation-delay: 1.3s; }

        @keyframes floaty {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.03); }
        }

        /* NAV (se reutiliza para NIVELES) */
        .nav {
            display: flex;
            gap: 10px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            padding: 10px;
            border-radius: 18px;
            margin-bottom: 14px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            border: 1px solid #bfdbfe;
            background: #ffffff;
            border-radius: 999px;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 800;
            font-size: 0.95rem;
            transition: transform 0.1s ease, background 0.15s ease, border-color 0.15s ease, opacity 0.1s ease;
            min-width: 120px;
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            background: #e0f2fe;
            border-color: #93c5fd;
        }

        .nav-btn.active {
            background: linear-gradient(90deg, #60a5fa, #2563eb);
            color: #fff;
            border-color: transparent;
        }

        h1 {
            margin: 0 0 4px 0;
            text-align: center;
            font-size: 1.35rem;
        }

        .subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 14px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            font-size: 0.9rem;
        }

        .xp,
        .hearts {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 700;
        }

        .xp span { color: #16a34a; }
        .hearts span { color: #f97316; }

        .progress-wrapper { margin-bottom: 14px; }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .progress {
            width: 100%;
            height: 10px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-inner {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(90deg, #60a5fa, #2563eb);
            transition: width 0.2s ease;
        }

        .card {
            border-radius: 20px;
            padding: 10px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            margin-bottom: 10px;
            transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
        }

        .card.correct {
            animation: pulse 0.4s ease;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
        }

        .card.wrong {
            animation: shake 0.3s ease;
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1) }
            50% { transform: scale(1.03) }
            100% { transform: scale(1) }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) }
            20% { transform: translateX(-4px) }
            40% { transform: translateX(4px) }
            60% { transform: translateX(-4px) }
            80% { transform: translateX(4px) }
        }

        .top-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .speak-btn {
            font-size: 1.6rem;
            cursor: pointer;
            background: #eff6ff;
            border-radius: 999px;
            border: 1px solid #bfdbfe;
            padding: 6px 10px;
            transition: transform 0.1s ease, background 0.15s ease, border-color 0.15s ease;
        }

        .speak-btn:hover {
            transform: scale(1.08);
            background: #dbeafe;
            border-color: #93c5fd;
        }

        .badge-level {
            background: #ffffff;
            border: 1px solid #bfdbfe;
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 900;
            font-size: 0.85rem;
            color: #1e3a8a;
        }

        .svg-wrap {
            margin: 8px 0 10px;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            background: #ffffff;
        }

        .sentence {
            text-align: center;
            font-size: 1.08rem;
            font-weight: 800;
            margin: 6px 0 2px;
            color: #111827;
        }

        .translation {
            text-align: center;
            font-size: 0.95rem;
            color: #6b7280;
            margin: 0 0 10px;
        }

        .hintline {
            text-align: center;
            font-size: 0.9rem;
            color: #374151;
            margin: 8px 0 0;
            font-weight: 700;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .option-btn {
            flex: 1;
            min-width: 92px;
            border-radius: 14px;
            border: 1px solid #d1d5db;
            background: #ffffff;
            padding: 8px 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.15s ease, transform 0.1s ease, border 0.1s ease, opacity 0.1s ease;
            font-weight: 700;
        }

        .option-btn:hover:not(:disabled) {
            background: #e0f2fe;
            transform: translateY(-1px);
            border-color: #93c5fd;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.6;
        }

        .feedback {
            margin-top: 10px;
            font-size: 0.95rem;
            text-align: center;
            min-height: 20px;
            font-weight: 800;
        }

        .feedback.good { color: #16a34a; }
        .feedback.bad { color: #ef4444; }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        button.main-btn {
            flex: 1;
            border: none;
            padding: 10px 12px;
            border-radius: 999px;
            font-size: 0.95rem;
            cursor: pointer;
            background: linear-gradient(90deg, #60a5fa, #2563eb);
            color: #ffffff;
            font-weight: 800;
            letter-spacing: 0.02em;
            transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.15s ease;
            min-width: 120px;
        }

        button.main-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            filter: brightness(1.05);
        }

        /* Secciones */
        .section { display: none; }
        .section.active { display: block; }

        /* =========================
           ‚úÖ TEOR√çA MEJORADA (NUEVO)
           ========================= */
        .theory-card{
            background: #ffffff;
            border: 1px solid #bfdbfe;
            border-radius: 20px;
            padding: 12px;
            margin: 10px 0 12px;
            box-shadow: 0 10px 22px rgba(37,99,235,.08);
        }
        .theory-head{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
            flex-wrap:wrap;
            margin-bottom: 8px;
        }
        .theory-title{
            font-weight: 950;
            color:#1e3a8a;
            display:flex;
            align-items:center;
            gap:8px;
            font-size: 1.02rem;
        }
        .theory-pill{
            background:#eff6ff;
            border:1px solid #bfdbfe;
            color:#1e3a8a;
            padding: 5px 10px;
            border-radius: 999px;
            font-weight: 900;
            font-size: .82rem;
        }
        .theory-grid{
            display:grid;
            grid-template-columns: 1fr;
            gap:10px;
        }
        .theory-box{
            background:#f9fafb;
            border:1px solid #e5e7eb;
            border-radius:16px;
            padding:10px;
        }
        .theory-box h3{
            margin:0 0 6px 0;
            font-size: .95rem;
            color:#111827;
            font-weight: 950;
        }
        .theory-box ul{
            margin:0;
            padding-left: 18px;
            color:#374151;
            font-weight: 700;
            font-size: .9rem;
        }
        .theory-eg{
            margin-top: 8px;
            background: #eff6ff;
            border: 1px dashed #93c5fd;
            border-radius: 14px;
            padding: 8px 10px;
            color:#1e3a8a;
            font-weight: 900;
            font-size: .9rem;
        }
        .theory-eg span{
            color:#111827;
            font-weight: 950;
        }
        .mini-table{
            width:100%;
            border-collapse: collapse;
            margin-top: 8px;
            overflow:hidden;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
            background:#fff;
            font-size: .9rem;
            font-weight: 750;
            color:#111827;
        }
        .mini-table th, .mini-table td{
            padding: 8px 10px;
            border-bottom: 1px solid #e5e7eb;
            text-align:left;
        }
        .mini-table th{
            background:#eff6ff;
            color:#1e3a8a;
            font-weight: 950;
        }
        .mini-table tr:last-child td{ border-bottom:none; }

        .theory-toggle{
            cursor:pointer;
            user-select:none;
            border:1px solid #bfdbfe;
            background:#eff6ff;
            border-radius: 999px;
            padding: 7px 10px;
            font-weight: 950;
            color:#1e3a8a;
            font-size:.86rem;
            transition: transform .1s ease, background .15s ease, border-color .15s ease;
        }
        .theory-toggle:hover{
            transform: translateY(-1px);
            background:#dbeafe;
            border-color:#93c5fd;
        }
        .theory-body.hidden{ display:none; }
    </style>
</head>

<body>
<div class="app">

    <!-- üåü Encabezado infantil: Marie Kids (CLICK -> index.html) -->
    <div class="brand-header-kids clickable"
         aria-label="Marie Kids"
         role="link"
         tabindex="0"
         onclick="goHome()"
         onkeydown="if(event.key==='Enter' || event.key===' '){ event.preventDefault(); goHome(); }">
        <div class="bubble b1"></div>
        <div class="bubble b2"></div>
        <div class="bubble b3"></div>

        <div class="star s1">‚≠ê</div>
        <div class="star s2">‚ú®</div>
        <div class="star s3">üåü</div>

        <div class="brand-row">
            <div class="kids-badge" aria-hidden="true">üß∏</div>
            <div>
                <div class="kids-title">Marie Kids</div>
                <div class="kids-subtitle">
                    Ingl√©s divertido
                    <span class="kids-pill">Escucha</span>
                    <span class="kids-pill">üëâ Responde</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NAV NIVELES -->
    <div class="nav" aria-label="Niveles">
        <button class="nav-btn active" id="tabL1" onclick="switchLevel('l1')">Nivel 1 (A1)</button>
        <button class="nav-btn" id="tabL2" onclick="switchLevel('l2')">Nivel 2 (A2)</button>
        <button class="nav-btn" id="tabL3" onclick="switchLevel('l3')">Nivel 3 (B1)</button>
    </div>

    <!-- ================== NIVEL 1 ================== -->
    <section class="section active" id="level1">
        <h1>Comparatives & Superlatives ‚Ä¢ Nivel 1</h1>
        <p class="subtitle">B√°sico: -er / -est + than / the. üìè</p>

        <!-- ‚úÖ TEOR√çA MEJORADA (NUEVO) -->
        <div class="theory-card" id="theoryCard">
            <div class="theory-head">
                <div class="theory-title">üìò Teor√≠a r√°pida <span class="theory-pill" id="theoryPill">Nivel 1 ‚Ä¢ A1</span></div>
                <button class="theory-toggle" onclick="toggleTheory()" id="theoryToggleBtn">Ocultar</button>
            </div>
            <div class="theory-body" id="theoryBody">
                <!-- Se inyecta por JS -->
            </div>
        </div>

        <div class="status-bar">
            <div class="xp">‚úÖ Correctas: <span id="xpValue">0</span></div>
            <div class="hearts">üß† Por mejorar: <span id="heartsValue">0</span></div>
        </div>

        <div class="progress-wrapper">
            <div class="progress-label">
                <span>Progreso del nivel</span>
                <span id="progressText">0/10</span>
            </div>
            <div class="progress">
                <div class="progress-inner" id="progressBar"></div>
            </div>
        </div>

        <div class="card" id="lessonCard">
            <div class="top-row">
                <span class="badge-level" id="levelBadge">Nivel 1 ‚Ä¢ A1</span>
                <button class="speak-btn" aria-label="Escuchar" onclick="speakPrompt()">üîä</button>
            </div>

            <!-- SVG educativa (se actualiza seg√∫n el nivel) -->
            <div class="svg-wrap" id="svgWrap"></div>

            <div class="sentence" id="sentenceEn">My house is ___ than yours.</div>
            <div class="translation" id="sentenceEs">Mi casa es ___ que la tuya.</div>

            <p class="hintline" id="hintLine">Elige la forma correcta.</p>

            <div class="options" id="optionsContainer"></div>
            <div class="feedback" id="feedback"></div>
        </div>

        <div class="controls">
            <button class="main-btn" onclick="nextLesson()">Next</button>
            <button class="main-btn" onclick="shareApp()">üì§ Compartir app</button>
        </div>
    </section>

    <!-- ================== AJEDREZ ================== -->
    <section class="section" id="courseChess">
        <h1>Ajedrez</h1>
        <p class="subtitle">Aqu√≠ puedes poner tus ejercicios de ajedrez. ‚ôüÔ∏è</p>

        <div class="card">
            <div class="sentence">En construcci√≥n</div>
            <p class="translation">¬øQuieres ‚Äúadivina la pieza‚Äù, ‚Äúmate en 1‚Äù, o ‚Äúmovimientos legales‚Äù?</p>
        </div>
    </section>

    <!-- ================== MATEM√ÅTICAS ================== -->
    <section class="section" id="courseMath">
        <h1>Matem√°ticas</h1>
        <p class="subtitle">Aqu√≠ puedes poner tus ejercicios de matem√°ticas. ‚ûó</p>

        <div class="card">
            <div class="sentence">En construcci√≥n</div>
            <p class="translation">¬øQuieres sumas/restas, multiplicaci√≥n, fracciones o problemas?</p>
        </div>
    </section>

</div>

<!-- Sonidos -->
<audio id="sound-correct" src="correct.mp3" preload="auto"></audio>
<audio id="sound-wrong" src="wrong.mp3" preload="auto"></audio>
<audio id="sound-levelup" src="levelup.mp3" preload="auto"></audio>

<script>
    // ‚úÖ IR A HOME (index.html)
    function goHome() {
        location.href = "index.html";
    }
</script>

<script>
    // ====== NIVELES ======
    let currentLevel = "l1";

    function switchLevel(level) {
        currentLevel = level;
        // mantener secciones
        document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
        document.getElementById("level1").classList.add("active"); // esta pantalla sirve para los 3 niveles

        document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
        document.getElementById(level === "l1" ? "tabL1" : level === "l2" ? "tabL2" : "tabL3").classList.add("active");

        resetLevelStats();
        renderTheory();   // ‚úÖ NUEVO
        renderLesson();
    }

    // ====== BANCO DE EJERCICIOS (3 NIVELES) ======
    // Cada ejercicio:
    // en/es: oraci√≥n con ___
    // answer: texto exacto correcto
    // options: 3 opciones (una correcta)
    // say: frase para TTS (sin ___ o con respuesta)
    // hint: peque√±a pista
    const LEVELS = {
        l1: {
            label: "Nivel 1 ‚Ä¢ A1",
            subtitle: "B√°sico: -er / -est + than / the.",
            max: 10,
            svg: "bars",
            items: [
                { en:"My house is ___ than yours.", es:"Mi casa es ___ que la tuya.", answer:"bigger", options:["big", "bigger", "biggest"], hint:"Comparativo (-er) + than.", say:"My house is bigger than yours." },
                { en:"She is ___ than me.", es:"Ella es ___ que yo.", answer:"taller", options:["tall", "taller", "the tallest"], hint:"Comparativo (-er).", say:"She is taller than me." },
                { en:"This car is ___ than that car.", es:"Este auto es ___ que ese auto.", answer:"faster", options:["fast", "faster", "the fastest"], hint:"Comparativo (-er).", say:"This car is faster than that car." },
                { en:"He is the ___ in the class.", es:"√âl es el ___ de la clase.", answer:"oldest", options:["older", "oldest", "old"], hint:"Superlativo (the + -est).", say:"He is the oldest in the class." },
                { en:"My sister is ___ than my brother.", es:"Mi hermana es ___ que mi hermano.", answer:"happier", options:["happy", "happier", "happiest"], hint:"y ‚Üí i + er.", say:"My sister is happier than my brother." },
                { en:"This is the ___ book.", es:"Este es el ___ libro.", answer:"best", options:["better", "best", "good"], hint:"Irregular: good ‚Üí best.", say:"This is the best book." },
                { en:"This bag is ___ than that bag.", es:"Esta mochila es ___ que esa mochila.", answer:"heavier", options:["heavy", "heavier", "the heaviest"], hint:"y ‚Üí i + er.", say:"This bag is heavier than that bag." },
                { en:"It is the ___ day of the week.", es:"Es el ___ d√≠a de la semana.", answer:"busiest", options:["busy", "busier", "busiest"], hint:"y ‚Üí i + est.", say:"It is the busiest day of the week." },
                { en:"My room is ___ than your room.", es:"Mi cuarto es ___ que tu cuarto.", answer:"cleaner", options:["clean", "cleaner", "cleanest"], hint:"Comparativo (-er).", say:"My room is cleaner than your room." },
                { en:"She is the ___ student.", es:"Ella es la ___ estudiante.", answer:"smartest", options:["smart", "smarter", "smartest"], hint:"Superlativo (the + -est).", say:"She is the smartest student." }
            ]
        },
        l2: {
            label: "Nivel 2 ‚Ä¢ A2",
            subtitle: "More / most ‚Ä¢ Less ‚Ä¢ as...as ‚Ä¢ not as...as.",
            max: 10,
            svg: "scale",
            items: [
                { en:"London is ___ than my city.", es:"Londres es ___ que mi ciudad.", answer:"more expensive", options:["expensive", "more expensive", "most expensive"], hint:"Adjetivo largo: more + adj.", say:"London is more expensive than my city." },
                { en:"This movie is ___ interesting than that one.", es:"Esta pel√≠cula es ___ interesante que esa.", answer:"more", options:["more", "most", "less"], hint:"Comparativo con adjetivo largo.", say:"This movie is more interesting than that one." },
                { en:"Watching golf is ___ exciting than football.", es:"Ver golf es ___ emocionante que f√∫tbol.", answer:"less", options:["less", "more", "most"], hint:"Comparaci√≥n negativa: less.", say:"Watching golf is less exciting than football." },
                { en:"I‚Äôm ___ tall ___ my dad.", es:"Soy ___ alto ___ mi pap√°.", answer:"as / as", options:["as / as", "more / than", "the / est"], hint:"Igualdad: as + adj + as.", say:"I‚Äôm as tall as my dad." },
                { en:"Her hair is ___ long ___ before.", es:"Su cabello no es tan largo como antes.", answer:"not as / as", options:["not as / as", "as / than", "less / as"], hint:"No igual: not as + adj + as.", say:"Her hair is not as long as before." },
                { en:"This test is ___ difficult than yesterday‚Äôs.", es:"Este examen es ___ dif√≠cil que el de ayer.", answer:"more", options:["more", "most", "as"], hint:"Comparativo: more difficult.", say:"This test is more difficult than yesterday‚Äôs." },
                { en:"She is the ___ intelligent person here.", es:"Ella es la persona m√°s inteligente aqu√≠.", answer:"most", options:["most", "more", "less"], hint:"Superlativo largo: the most.", say:"She is the most intelligent person here." },
                { en:"My phone is ___ good ___ yours.", es:"Mi tel√©fono es tan bueno como el tuyo.", answer:"as / as", options:["as / as", "more / than", "less / than"], hint:"Igualdad: as...as.", say:"My phone is as good as yours." },
                { en:"This room is ___ noisy than the kitchen.", es:"Este cuarto es ___ ruidoso que la cocina.", answer:"less", options:["less", "more", "most"], hint:"Comparaci√≥n negativa: less noisy.", say:"This room is less noisy than the kitchen." },
                { en:"That is the ___ expensive option.", es:"Esa es la opci√≥n m√°s cara.", answer:"most", options:["most", "more", "less"], hint:"Superlativo largo: the most.", say:"That is the most expensive option." }
            ]
        },
        l3: {
            label: "Nivel 3 ‚Ä¢ B1",
            subtitle: "Modifiers: much / far / a lot ‚Ä¢ a bit / slightly ‚Ä¢ frases reales.",
            max: 10,
            svg: "trophy",
            items: [
                { en:"She is ___ older than me.", es:"Ella es ___ mayor que yo.", answer:"much", options:["much", "a bit", "as"], hint:"Diferencia grande: much.", say:"She is much older than me." },
                { en:"This route is ___ longer than the other one.", es:"Esta ruta es ___ m√°s larga que la otra.", answer:"far", options:["far", "slightly", "the"], hint:"Diferencia grande: far.", say:"This route is far longer than the other one." },
                { en:"I‚Äôm ___ taller than my brother.", es:"Soy ___ m√°s alto que mi hermano.", answer:"a bit", options:["a bit", "much", "most"], hint:"Diferencia peque√±a: a bit.", say:"I‚Äôm a bit taller than my brother." },
                { en:"This is ___ the best meal I‚Äôve ever had.", es:"Esta es ___ la mejor comida que he comido.", answer:"by far", options:["by far", "a little", "less"], hint:"√ânfasis superlativo: by far.", say:"This is by far the best meal I‚Äôve ever had." },
                { en:"The new model is ___ better than the old one.", es:"El modelo nuevo es ___ mejor que el viejo.", answer:"a lot", options:["a lot", "as", "the"], hint:"Diferencia grande: a lot better.", say:"The new model is a lot better than the old one." },
                { en:"This explanation is ___ clearer than the previous one.", es:"Esta explicaci√≥n es ___ m√°s clara que la anterior.", answer:"slightly", options:["slightly", "most", "far"], hint:"Diferencia peque√±a: slightly.", say:"This explanation is slightly clearer than the previous one." },
                { en:"Her plan is ___ realistic than his plan.", es:"Su plan es ___ realista que el de √©l.", answer:"more", options:["more", "most", "less"], hint:"Comparativo largo: more realistic.", say:"Her plan is more realistic than his plan." },
                { en:"This is the ___ useful tip in the guide.", es:"Este es el consejo m√°s √∫til de la gu√≠a.", answer:"most", options:["most", "more", "less"], hint:"Superlativo largo: the most useful.", say:"This is the most useful tip in the guide." },
                { en:"My idea is not ___ good ___ yours, but it‚Äôs faster.", es:"Mi idea no es tan buena como la tuya, pero es m√°s r√°pida.", answer:"as / as", options:["as / as", "more / than", "less / than"], hint:"Not as...as.", say:"My idea is not as good as yours, but it is faster." },
                { en:"This is the ___ challenging part of the project.", es:"Esta es la parte m√°s desafiante del proyecto.", answer:"most", options:["most", "more", "less"], hint:"Superlativo largo.", say:"This is the most challenging part of the project." }
            ]
        }
    };

    // ====== ESTADO ======
    let currentItem = null;
    let correctCount = 0;
    let wrongCount = 0;
    let answeredCorrectly = false;

    let progress = 0;

    // DOM
    const correctSpan = document.getElementById("xpValue");
    const wrongSpan = document.getElementById("heartsValue");
    const feedbackEl = document.getElementById("feedback");
    const lessonCard = document.getElementById("lessonCard");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const sentenceEnEl = document.getElementById("sentenceEn");
    const sentenceEsEl = document.getElementById("sentenceEs");
    const hintLineEl = document.getElementById("hintLine");
    const svgWrap = document.getElementById("svgWrap");
    const levelBadge = document.getElementById("levelBadge");

    // Theory DOM
    const theoryBody = document.getElementById("theoryBody");
    const theoryPill = document.getElementById("theoryPill");
    const theoryToggleBtn = document.getElementById("theoryToggleBtn");

    // Sounds
    const soundCorrect = document.getElementById("sound-correct");
    const soundWrong = document.getElementById("sound-wrong");
    const soundLevelup = document.getElementById("sound-levelup");

    function resetLevelStats() {
        correctCount = 0;
        wrongCount = 0;
        progress = 0;
        correctSpan.textContent = "0";
        wrongSpan.textContent = "0";
        updateProgressBar();
    }

    function updateProgressBar() {
        const maxProgress = LEVELS[currentLevel].max;
        const percent = (progress / maxProgress) * 100;
        progressBar.style.width = percent + "%";
        progressText.textContent = `${progress}/${maxProgress}`;
    }

    function randomFromArray(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function pickExercise() {
        const pool = LEVELS[currentLevel].items;
        return randomFromArray(pool);
    }

    function setHeaderTextsForLevel() {
        levelBadge.textContent = LEVELS[currentLevel].label;
        // Mantenemos el h1/subtitle del nivel 1 porque la UI es una sola secci√≥n:
        document.querySelector("#level1 h1").textContent = `Comparatives & Superlatives ‚Ä¢ ${LEVELS[currentLevel].label.replace("‚Ä¢ ", "")}`;
        document.querySelector("#level1 .subtitle").textContent = LEVELS[currentLevel].subtitle;
        theoryPill.textContent = LEVELS[currentLevel].label; // ‚úÖ NUEVO
    }

    function svgTemplate(type) {
        // SVG educativas, offline, sin im√°genes externas
        if (type === "bars") {
            return `
            <svg viewBox="0 0 320 130" width="100%" height="130" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="#93c5fd"/>
                  <stop offset="1" stop-color="#2563eb"/>
                </linearGradient>
              </defs>
              <rect x="10" y="10" width="300" height="110" rx="18" fill="#ffffff"/>
              <rect x="22" y="78" width="70" height="34" rx="12" fill="#93c5fd"/>
              <rect x="125" y="50" width="70" height="62" rx="12" fill="#60a5fa"/>
              <rect x="228" y="26" width="70" height="86" rx="12" fill="#2563eb"/>
              <text x="28" y="70" font-size="12" fill="#1e3a8a" font-weight="800">small</text>
              <text x="126" y="42" font-size="12" fill="#1e3a8a" font-weight="800">smaller/bigger</text>
              <text x="232" y="18" font-size="12" fill="#2563eb" font-weight="900">the smallest/biggest</text>
              <text x="22" y="122" font-size="11" fill="#6b7280" font-weight="700">Comparative (-er) + than ‚Ä¢ Superlative (the + -est)</text>
            </svg>`;
        }
        if (type === "scale") {
            return `
            <svg viewBox="0 0 320 130" width="100%" height="130" xmlns="http://www.w3.org/2000/svg">
              <rect x="10" y="10" width="300" height="110" rx="18" fill="#ffffff"/>
              <text x="18" y="30" font-size="12" fill="#1e3a8a" font-weight="900">as...as</text>
              <text x="96" y="30" font-size="12" fill="#1e3a8a" font-weight="900">more / less</text>
              <text x="220" y="30" font-size="12" fill="#1e3a8a" font-weight="900">the most</text>

              <line x1="40" y1="92" x2="280" y2="92" stroke="#bfdbfe" stroke-width="6" stroke-linecap="round"/>
              <circle cx="75" cy="92" r="14" fill="#60a5fa"/>
              <circle cx="160" cy="92" r="14" fill="#93c5fd"/>
              <circle cx="245" cy="92" r="14" fill="#2563eb"/>

              <text x="56" y="118" font-size="11" fill="#6b7280" font-weight="800">equal</text>
              <text x="132" y="118" font-size="11" fill="#6b7280" font-weight="800">compare</text>
              <text x="228" y="118" font-size="11" fill="#6b7280" font-weight="800">top</text>
            </svg>`;
        }
        // trophy
        return `
        <svg viewBox="0 0 320 130" width="100%" height="130" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="gold" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#fde68a"/>
              <stop offset="1" stop-color="#f59e0b"/>
            </linearGradient>
          </defs>
          <rect x="10" y="10" width="300" height="110" rx="18" fill="#ffffff"/>
          <path d="M140 32 h40 v10 c0 18-10 28-20 28s-20-10-20-28z" fill="url(#gold)" stroke="#f59e0b" stroke-width="2"/>
          <rect x="150" y="70" width="20" height="14" rx="4" fill="#f59e0b"/>
          <rect x="130" y="84" width="60" height="16" rx="6" fill="#2563eb" opacity="0.9"/>
          <text x="112" y="30" font-size="12" fill="#1e3a8a" font-weight="900">much / far / a lot</text>
          <text x="210" y="30" font-size="12" fill="#1e3a8a" font-weight="900">a bit / slightly</text>
          <text x="92" y="115" font-size="11" fill="#6b7280" font-weight="800">Modifiers = cu√°nta diferencia hay</text>
        </svg>`;
    }

    // =========================
    // ‚úÖ TEOR√çA MEJORADA (NUEVO)
    // =========================
    let theoryHidden = false;

    function toggleTheory(){
        theoryHidden = !theoryHidden;
        theoryBody.classList.toggle("hidden", theoryHidden);
        theoryToggleBtn.textContent = theoryHidden ? "Mostrar" : "Ocultar";
    }

    function theoryHTML(levelKey){
        if(levelKey === "l1"){
            return `
            <div class="theory-grid">
                <div class="theory-box">
                    <h3>‚úÖ Comparatives (2 cosas)</h3>
                    <ul>
                        <li><b>Adjetivo corto (1 s√≠laba):</b> adj + <b>-er</b> + <b>than</b></li>
                        <li><b>Ej:</b> tall ‚Üí <b>taller than</b></li>
                        <li><b>-y:</b> y ‚Üí i + er (happy ‚Üí <b>happier</b>)</li>
                        <li><b>Regla r√°pida:</b> si puedes decir ‚Äúm√°s ___ que‚Äù, usas <b>than</b>.</li>
                    </ul>
                    <div class="theory-eg">üìå <span>She is taller than me.</span> = Ella es m√°s alta que yo.</div>
                    <table class="mini-table">
                        <tr><th>Base</th><th>Comparativo</th><th>Ejemplo</th></tr>
                        <tr><td>big</td><td><b>bigger</b></td><td>bigger than</td></tr>
                        <tr><td>fast</td><td><b>faster</b></td><td>faster than</td></tr>
                        <tr><td>happy</td><td><b>happier</b></td><td>happier than</td></tr>
                    </table>
                </div>

                <div class="theory-box">
                    <h3>üèÜ Superlatives (el/la + del grupo)</h3>
                    <ul>
                        <li><b>Adjetivo corto:</b> <b>the</b> + adj + <b>-est</b></li>
                        <li><b>Ej:</b> old ‚Üí <b>the oldest</b></li>
                        <li><b>Irregular:</b> good ‚Üí <b>better</b> / <b>the best</b></li>
                        <li><b>Regla r√°pida:</b> si dices ‚Äúel m√°s ___‚Äù, usas <b>the</b>.</li>
                    </ul>
                    <div class="theory-eg">üìå <span>He is the oldest in the class.</span> = √âl es el mayor de la clase.</div>
                    <table class="mini-table">
                        <tr><th>Base</th><th>Superlativo</th><th>Ejemplo</th></tr>
                        <tr><td>smart</td><td><b>the smartest</b></td><td>the smartest student</td></tr>
                        <tr><td>busy</td><td><b>the busiest</b></td><td>the busiest day</td></tr>
                        <tr><td>good</td><td><b>the best</b></td><td>the best book</td></tr>
                    </table>
                </div>
            </div>`;
        }

        if(levelKey === "l2"){
            return `
            <div class="theory-grid">
                <div class="theory-box">
                    <h3>‚úÖ Adjetivos largos: more / most</h3>
                    <ul>
                        <li><b>Comparativo:</b> <b>more</b> + adjective + <b>than</b></li>
                        <li><b>Superlativo:</b> <b>the most</b> + adjective</li>
                        <li><b>Ej:</b> expensive ‚Üí <b>more expensive than</b> / <b>the most expensive</b></li>
                    </ul>
                    <div class="theory-eg">üìå <span>London is more expensive than my city.</span></div>
                    <table class="mini-table">
                        <tr><th>Adjetivo</th><th>Comparativo</th><th>Superlativo</th></tr>
                        <tr><td>beautiful</td><td><b>more beautiful</b></td><td><b>the most beautiful</b></td></tr>
                        <tr><td>interesting</td><td><b>more interesting</b></td><td><b>the most interesting</b></td></tr>
                    </table>
                </div>

                <div class="theory-box">
                    <h3>‚öñÔ∏è less / as...as / not as...as</h3>
                    <ul>
                        <li><b>Menos:</b> <b>less</b> + adjective + <b>than</b></li>
                        <li><b>Igual:</b> <b>as</b> + adjective + <b>as</b></li>
                        <li><b>No igual:</b> <b>not as</b> + adjective + <b>as</b></li>
                        <li><b>Tip:</b> ‚Äútan...como‚Äù = <b>as...as</b></li>
                    </ul>
                    <div class="theory-eg">üìå <span>I‚Äôm as tall as my dad.</span> = Soy tan alto como mi pap√°.</div>
                    <table class="mini-table">
                        <tr><th>Idea</th><th>Estructura</th><th>Ejemplo</th></tr>
                        <tr><td>Menos</td><td>less + adj + than</td><td>less noisy than</td></tr>
                        <tr><td>Igual</td><td>as + adj + as</td><td>as good as</td></tr>
                        <tr><td>No igual</td><td>not as + adj + as</td><td>not as long as</td></tr>
                    </table>
                </div>
            </div>`;
        }

        // l3
        return `
        <div class="theory-grid">
            <div class="theory-box">
                <h3>üöÄ Modifiers (cu√°nta diferencia hay)</h3>
                <ul>
                    <li><b>Grande:</b> much / far / a lot / so much</li>
                    <li><b>Peque√±a:</b> a bit / a little / slightly</li>
                    <li><b>Uso:</b> modifier + comparative</li>
                    <li><b>Ej:</b> <b>much</b> better, <b>slightly</b> colder</li>
                </ul>
                <div class="theory-eg">üìå <span>The new model is a lot better than the old one.</span></div>
                <table class="mini-table">
                    <tr><th>Tipo</th><th>Palabras</th><th>Ejemplo</th></tr>
                    <tr><td>Diferencia grande</td><td>much / far / a lot</td><td>much older than</td></tr>
                    <tr><td>Diferencia peque√±a</td><td>a bit / slightly</td><td>a bit taller than</td></tr>
                </table>
            </div>

            <div class="theory-box">
                <h3>üèÜ √ânfasis en superlativos</h3>
                <ul>
                    <li><b>by far</b> = ‚Äúpor mucho‚Äù (enfatiza el superlativo)</li>
                    <li>Se usa antes del superlativo: <b>by far the best</b></li>
                    <li><b>Tip:</b> √∫salo cuando quieres sonar natural en B1.</li>
                </ul>
                <div class="theory-eg">üìå <span>This is by far the best meal I‚Äôve ever had.</span></div>
                <table class="mini-table">
                    <tr><th>Frase</th><th>Significado</th><th>Ejemplo</th></tr>
                    <tr><td>by far</td><td>por mucho</td><td>by far the most useful</td></tr>
                    <tr><td>not as...as</td><td>no tan...como</td><td>not as good as</td></tr>
                </table>
            </div>
        </div>`;
    }

    function renderTheory(){
        setHeaderTextsForLevel();
        theoryBody.innerHTML = theoryHTML(currentLevel);
    }

    function renderLesson() {
        answeredCorrectly = false;
        setHeaderTextsForLevel();
        renderTheory(); // ‚úÖ NUEVO: asegura teor√≠a correcta siempre

        // SVG por nivel
        svgWrap.innerHTML = svgTemplate(LEVELS[currentLevel].svg);

        // ejercicio
        currentItem = pickExercise();
        sentenceEnEl.textContent = currentItem.en;
        sentenceEsEl.textContent = currentItem.es;
        hintLineEl.textContent = currentItem.hint || "Elige la forma correcta.";

        feedbackEl.textContent = "";
        feedbackEl.classList.remove("good", "bad");
        lessonCard.classList.remove("correct", "wrong");

        createOptions();
    }

    function createOptions() {
        const container = document.getElementById("optionsContainer");
        container.innerHTML = "";

        const opts = [...currentItem.options];
        shuffleArray(opts);

        opts.forEach(optionText => {
            const btn = document.createElement("button");
            btn.textContent = optionText;
            btn.className = "option-btn";
            btn.onclick = () => checkAnswer(optionText, btn);
            container.appendChild(btn);
        });
    }

    function speakText(text) {
        if (!("speechSynthesis" in window)) return;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = "en-US";
        utter.rate = 0.95;
        utter.pitch = 1.02;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
    }

    function speakPrompt() {
        // lee la frase con respuesta (si existe 'say')
        const text = currentItem && currentItem.say ? currentItem.say : (sentenceEnEl.textContent || "");
        speakText(text);
    }

    function playSound(audioElement) {
        if (!audioElement) return;
        audioElement.currentTime = 0;
        audioElement.play().catch(() => { });
    }

    function checkAnswer(answer, clickedBtn) {
        if (!currentItem) return;
        if (answeredCorrectly) return;

        if (answer === currentItem.answer) {
            answeredCorrectly = true;

            correctCount++;
            correctSpan.textContent = correctCount;

            const maxProgress = LEVELS[currentLevel].max;
            if (progress < maxProgress) {
                progress += 1;
                updateProgressBar();
            }

            feedbackEl.textContent = randomFromArray(["‚úÖ Great job!", "‚úÖ Awesome!", "‚úÖ Perfect!", "‚úÖ Nice!"]);
            feedbackEl.classList.remove("bad");
            feedbackEl.classList.add("good");

            playSound(soundCorrect);
            speakText(randomFromArray(["Great job!", "Awesome!", "Perfect!", "Nice work!"]));

            lessonCard.classList.remove("wrong");
            lessonCard.classList.add("correct");

            document.querySelectorAll(".option-btn").forEach(b => { b.disabled = true; });

            if (correctCount > 0 && correctCount % 5 === 0) playSound(soundLevelup);

            if (progress >= maxProgress) {
                feedbackEl.textContent = "üéâ ¬°Nivel completado! Cambia a Nivel 2 o repite para practicar m√°s.";
                feedbackEl.classList.add("good");
                playSound(soundLevelup);
            }
        } else {
            wrongCount++;
            wrongSpan.textContent = wrongCount;

            feedbackEl.textContent = `‚ùå Not yet. Try again.`;
            feedbackEl.classList.remove("good");
            feedbackEl.classList.add("bad");

            playSound(soundWrong);
            speakText(randomFromArray(["Not yet, try again.", "Almost, try again.", "Keep trying.", "Don't give up."]));

            lessonCard.classList.remove("correct");
            lessonCard.classList.add("wrong");

            if (clickedBtn) clickedBtn.disabled = true;
        }
    }

    function shuffleArray(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }

    function nextLesson() { renderLesson(); }

    // ====== SHARE ======
    function shareApp() {
        const shareData = {
            title: "Marie Kids",
            text: "üìö Comparatives & Superlatives ‚Ä¢ 3 niveles",
            url: window.location.href
        };

        if (navigator.share) {
            navigator.share(shareData).catch(() => { });
        } else {
            navigator.clipboard.writeText(shareData.url);
            alert("üîó Link copiado para compartir");
        }
    }

    // init
    updateProgressBar();
    renderTheory(); // ‚úÖ NUEVO
    renderLesson();
</script>

<script>
    // Registrar Service Worker (PWA)
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("./service-worker.js").catch(() => { });
        });
    }
</script>

</body>
</html>
