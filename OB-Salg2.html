<!doctype html>
<html lang="es">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marie Kids ‚Ä¢ Suma Algebraica</title>

<style>
:root{
  --bg1:#dbeafe;
  --bg2:#e0f2fe;
  --card:#fff;
  --radius:22px;
  --shadow:0 18px 40px rgba(0,0,0,.14);
  --ok:#16a34a;
  --bad:#ef4444;
}

*{box-sizing:border-box;font-family:system-ui}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(145deg,var(--bg2),var(--bg1));
}

.app{
  max-width:520px;
  width:100%;
  background:#fff;
  border-radius:22px;
  padding:14px;
  box-shadow:var(--shadow);
}

.header{
  display:flex;
  gap:10px;
  margin-bottom:8px;
  align-items:center;
}

.logo{
  width:44px;height:44px;
  border-radius:14px;
  background:linear-gradient(135deg,#2563eb,#6366f1);
  color:#fff;font-weight:900;
  display:grid;place-items:center;
}

.status-bar{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  padding:8px 14px;
  border-radius:999px;
  background:#eff6ff;
  border:1px solid #bfdbfe;
  font-weight:900;
}

.xp{color:#16a34a}
.hearts{color:#dc2626}

.card{
  background:#f9fafb;
  border-radius:20px;
  padding:18px;
  text-align:center;
}

.operation-row{
  display:flex;
  justify-content:center;
  gap:14px;
  font-size:3rem;
  font-weight:900;
  margin:18px 0;
  color:#2563eb;
}

.speak-btn{
  border-radius:999px;
  border:1px solid #c7d2fe;
  padding:6px 10px;
  background:#eff6ff;
  cursor:pointer;
}

.options{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.option{
  flex:1;
  min-width:80px;
  padding:10px;
  font-weight:900;
  border-radius:14px;
  border:1px solid #c7d2fe;
  background:#fff;
  cursor:pointer;
}

.option:disabled{
  opacity:.45;
  cursor:not-allowed;
}

.feedback{
  margin-top:14px;
  font-weight:900;
  min-height:24px;
}

.good{color:var(--ok)}
.bad{color:var(--bad)}

.mini-btn{
  margin-top:6px;
  border-radius:14px;
  padding:10px;
  font-weight:900;
  cursor:pointer;
  background:#fff;
  border:1px solid #c7d2fe;
}

.solution{
  display:none;
  margin-top:12px;
  text-align:left;
  background:#fff;
  border-radius:16px;
  padding:12px;
  border:1px solid #c7d2fe;
}

.solution.show{display:block}

.steps{
  padding-left:18px;
  font-size:13px;
  font-weight:800;
}

.mathline{
  margin-top:8px;
  font-family:monospace;
  font-weight:900;
  background:#f1f5f9;
  padding:6px 10px;
  border-radius:10px;
}

button.primary{
  margin-top:10px;
  border:none;
  border-radius:14px;
  padding:10px;
  font-weight:900;
  background:#22c55e;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">

<div class="header">
  <div class="logo">MK</div>
  <div>
    <strong>Suma algebraica</strong><br>
    <small>Un intento por ejercicio</small>
  </div>
</div>

<div class="status-bar">
  <div class="xp">‚úÖ Correctas: <span id="ok">0</span>/20</div>
  <div class="hearts">üß† Por mejorar: <span id="bad">0</span>/20</div>
</div>

<div class="card">

  <div class="operation-row">
    <span id="a">3</span>
    <span id="sign">+</span>
    <span id="b">4</span>
    <button class="speak-btn" onclick="speakExercise()">üîä</button>
  </div>

  <button class="mini-btn" onclick="toggleSolution()">üëÄ Ver soluci√≥n</button>

  <div class="solution" id="solutionBox">
    <ol class="steps" id="stepsList"></ol>
    <div class="mathline" id="finalLine"></div>
  </div>

  <div class="options" id="options"></div>
  <div class="feedback" id="feedback"></div>

  <button class="primary" onclick="newExercise()">‚û°Ô∏è Siguiente</button>

</div>

</div>

<script>
const TOTAL = 20;
let correctas = 0;
let errores = 0;
let current = {};
let bloqueado = false;

/* === AUDIO (SIN MP3) === */
let audioCtx=null;
function unlockAudio(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}
document.addEventListener("pointerdown",unlockAudio,{once:true});

function playSuccess(){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.setValueAtTime(900,audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1300,audioCtx.currentTime+.12);
  g.gain.setValueAtTime(.25,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.15);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.15);
}

function playError(){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.setValueAtTime(240,audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(120,audioCtx.currentTime+.18);
  g.gain.setValueAtTime(.25,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.22);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.22);
}

function rand(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

function newExercise(){
  bloqueado=false;
  document.getElementById("feedback").textContent="";
  document.getElementById("solutionBox").classList.remove("show");

  const a=rand(-20,-1);
  const b=rand(-20,-1);
  if(a===0&&b===0) return newExercise();

  current={a,b,ans:a+b};

  document.getElementById("a").textContent=a;
  document.getElementById("b").textContent=Math.abs(b);
  document.getElementById("sign").textContent=b>=0?"+":"-";

  const opts=new Set([current.ans]);
  while(opts.size<3) opts.add(current.ans+rand(-6,6));

  const cont=document.getElementById("options");
  cont.innerHTML="";
  [...opts].sort(()=>Math.random()-.5).forEach(v=>{
    const btn=document.createElement("button");
    btn.className="option";
    btn.textContent=v;
    btn.onclick=()=>check(v);
    cont.appendChild(btn);
  });

  renderSolution();
}

function check(val){
  if(bloqueado) return;
  bloqueado=true;

  document.querySelectorAll(".option").forEach(b=>b.disabled=true);

  const fb=document.getElementById("feedback");
  if(val===current.ans){
    correctas++;
    fb.textContent="‚úÖ ¬°Correcto!";
    fb.className="feedback good";
    document.getElementById("ok").textContent=correctas;
    playSuccess();
  }else{
    errores++;
    fb.textContent="‚ùå Incorrecto (solo un intento)";
    fb.className="feedback bad";
    document.getElementById("bad").textContent=errores;
    playError();
  }
}

function toggleSolution(){
  document.getElementById("solutionBox").classList.toggle("show");
}

function renderSolution(){
  const {a,b,ans}=current;
  const s=document.getElementById("stepsList");
  s.innerHTML="";
  s.innerHTML+=`<li>Identificamos los signos.</li>`;
  s.innerHTML+=`<li>Aplicamos la regla correcta.</li>`;
  s.innerHTML+=`<li>${a} + ${b} = ${ans}</li>`;
  document.getElementById("finalLine").textContent=`${a} + ${b} = ${ans}`;
}

function speakExercise(){
  if(!("speechSynthesis" in window))return;
  const {a,b}=current;
  const txt=`${a<0?"menos "+Math.abs(a):a} ${b>=0?"m√°s":"menos"} ${Math.abs(b)}`;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="es-PE";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

newExercise();
</script>

</body>
</html>
