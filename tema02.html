<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Cursos ‚Ä¢ Suma Algebraica (Enteros)</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1976d2">

  <style>
    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(145deg, #dbeafe, #e0f2fe);
      padding: 18px;
    }

    .app {
      background: #ffffff;
      width: 100%;
      max-width: 520px;
      padding: 18px;
      border-radius: 24px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
      border: 3px solid #2563eb;
    }

    /* üåü Encabezado infantil */
    .brand-header-kids {
      position: relative;
      overflow: hidden;
      padding: 14px 14px 12px;
      border-radius: 22px;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #93c5fd, #60a5fa, #2563eb);
      border: 2px solid rgba(255, 255, 255, .65);
      box-shadow: 0 14px 28px rgba(37, 99, 235, .25);
      color: #fff;
    }

    .brand-header-kids.clickable {
      cursor: pointer;
      user-select: none;
      transition: transform 0.12s ease, filter 0.12s ease, box-shadow 0.12s ease;
    }

    .brand-header-kids.clickable:hover {
      transform: translateY(-1px);
      filter: brightness(1.02);
      box-shadow: 0 18px 34px rgba(37, 99, 235, .28);
    }

    .brand-header-kids.clickable:active { transform: translateY(0px) scale(0.995); }

    .brand-header-kids .bubble,
    .brand-header-kids .star { pointer-events: none; }

    .brand-row {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .kids-badge {
      width: 52px;
      height: 52px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      font-size: 1.55rem;
      background: rgba(255, 255, 255, .22);
      border: 1px solid rgba(255, 255, 255, .35);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, .35);
    }

    .kids-title {
      font-weight: 950;
      font-size: 1.55rem;
      letter-spacing: .02em;
      line-height: 1.05;
      text-shadow: 0 2px 0 rgba(0, 0, 0, .12);
    }

    .kids-subtitle {
      margin-top: 4px;
      font-size: .9rem;
      font-weight: 750;
      opacity: .95;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .kids-pill {
      background: rgba(255, 255, 255, .22);
      border: 1px solid rgba(255, 255, 255, .35);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .82rem;
      font-weight: 850;
    }

    .star {
      position: absolute;
      z-index: 1;
      opacity: .9;
      filter: drop-shadow(0 2px 0 rgba(0, 0, 0, .12));
      animation: twinkle 2.8s ease-in-out infinite;
      pointer-events: none;
    }

    .star.s1 { top: 8px; right: 18px; font-size: 1.15rem; animation-delay: 0s; }
    .star.s2 { top: 40px; right: 60px; font-size: .95rem; animation-delay: .6s; }
    .star.s3 { bottom: 12px; right: 26px; font-size: 1.25rem; animation-delay: 1.1s; }

    @keyframes twinkle {
      0%, 100% { transform: scale(1); opacity: .9; }
      50% { transform: scale(1.08); opacity: 1; }
    }

    .bubble {
      position: absolute;
      z-index: 0;
      border-radius: 999px;
      background: rgba(255, 255, 255, .22);
      border: 1px solid rgba(255, 255, 255, .28);
      box-shadow: inset 0 2px 0 rgba(255, 255, 255, .45);
      pointer-events: none;
      -webkit-backdrop-filter: blur(2px);
      backdrop-filter: blur(2px);
      animation: floaty 6s ease-in-out infinite;
    }

    .b1 { left: -16px; top: -18px; animation-delay: 0s; transform: rotate(5deg); width: 84px; height: 84px; }
    .b2 { left: 40px; bottom: -22px; width: 52px; height: 52px; animation-delay: .8s; }
    .b3 { right: -22px; bottom: -26px; width: 76px; height: 76px; animation-delay: 1.3s; }

    @keyframes floaty {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.03); }
    }

    h1 {
      margin: 0 0 4px 0;
      text-align: center;
      font-size: 1.5rem;
    }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 14px;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      font-size: 0.9rem;
    }

    .xp, .hearts {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
    }

    .xp span { color: #16a34a; }
    .hearts span { color: #f97316; }

    .progress-wrapper { margin-bottom: 14px; }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .progress {
      width: 100%;
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #60a5fa, #2563eb);
      transition: width 0.2s ease;
    }

    .card {
      border-radius: 20px;
      padding: 5px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      margin-bottom: 5px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }

    .card.correct {
      animation: pulse 0.4s ease;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
    }

    .card.wrong {
      animation: shake 0.3s ease;
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
    }

    @keyframes pulse { 0% { transform: scale(1) } 50% { transform: scale(1.03) } 100% { transform: scale(1) } }
    @keyframes shake {
      0%, 100% { transform: translateX(0) }
      20% { transform: translateX(-4px) }
      40% { transform: translateX(4px) }
      60% { transform: translateX(-4px) }
      80% { transform: translateX(4px) }
    }

    .emoji-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }

    .emoji { font-size: 5rem; text-align: center; }

    .speak-btn {
      font-size: 1.6rem;
      cursor: pointer;
      background: #eff6ff;
      border-radius: 999px;
      border: 1px solid #bfdbfe;
      padding: 6px 10px;
      transition: transform 0.1s ease, background 0.15s ease, border-color 0.15s ease;
    }

    .speak-btn:hover {
      transform: scale(1.1);
      background: #dbeafe;
      border-color: #93c5fd;
    }

    .word {
      text-align: center;
      font-size: 1.6rem;
      font-weight: 900;
      margin-bottom: 2px;
      letter-spacing: .02em;
    }

    .translation {
      text-align: center;
      font-size: 0.95rem;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .example-en, .example-es, .question {
      font-size: 0.98rem;
      margin: 6px 0;
    }

    .label { font-weight: 800; }

    .question {
      margin-top: 12px;
      font-weight: 900;
      color: #111827;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    button.main-btn {
      flex: 1;
      border: none;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 0.95rem;
      cursor: pointer;
      background: linear-gradient(90deg, #60a5fa, #2563eb);
      color: #ffffff;
      font-weight: 800;
      letter-spacing: 0.02em;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.15s ease;
      min-width: 120px;
    }

    button.main-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      filter: brightness(1.05);
    }

    .feedback {
      margin-top: 10px;
      font-size: 0.95rem;
      text-align: center;
      min-height: 5px;
      font-weight: 800;
    }

    .feedback.good { color: #16a34a; }
    .feedback.bad { color: #ef4444; }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .option-btn {
      flex: 1;
      min-width: 80px;
      border-radius: 14px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      padding: 8px 10px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, border 0.1s ease, opacity 0.1s ease;
      font-weight: 900;
    }

    .option-btn:hover:not(:disabled) {
      background: #e0f2fe;
      transform: translateY(-1px);
      border-color: #93c5fd;
    }

    .option-btn:disabled { cursor: default; opacity: 0.6; }

    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>

<body>
  <div class="app">

    <!-- üåü Encabezado infantil: Marie Kids (CLICK -> index.html) -->
    <div class="brand-header-kids clickable"
      aria-label="Marie Kids"
      role="link"
      tabindex="0"
      onclick="goHome()"
      onkeydown="if(event.key==='Enter' || event.key===' '){ event.preventDefault(); goHome(); }">
      <div class="bubble b1"></div>
      <div class="bubble b2"></div>
      <div class="bubble b3"></div>

      <div class="star s1">‚≠ê</div>
      <div class="star s2">‚ú®</div>
      <div class="star s3">üåü</div>

      <div class="brand-row">
        <div class="kids-badge" aria-hidden="true">üß∏</div>
        <div>
          <div class="kids-title">Marie Kids</div>
          <div class="kids-subtitle">
            Matem√°ticas divertidas
            <span class="kids-pill">Ejemplos parecidos</span>
            <span class="kids-pill">üëâ Elige</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ================== SUMA ALGEBRAICA (ENTEROS) ================== -->
    <section class="section active" id="courseMathAlgebra">
      <h1>Suma algebraica ‚Ä¢ Enteros</h1>
      <p class="subtitle">El ejemplo resuelto sale con n√∫meros del mismo rango que el ejercicio actual. ‚ûï‚ûñ</p>

      <div class="status-bar">
        <div class="xp">‚úÖ Correctas: <span id="xpValue">0</span></div>
        <div class="hearts">üß† Por mejorar: <span id="heartsValue">0</span></div>
      </div>

      <div class="progress-wrapper">
        <div class="progress-label">
          <span>Progreso de la lecci√≥n</span>
          <span id="progressText">0/10</span>
        </div>
        <div class="progress">
          <div class="progress-inner" id="progressBar"></div>
        </div>
      </div>

      <div class="card" id="lessonCard">
        <div class="emoji-container">
          <div class="emoji" id="emoji">‚ûï</div>
          <button class="speak-btn" aria-label="Escuchar operaci√≥n" onclick="speakOperation()">üîä</button>
        </div>

        <div class="word" id="operationText">-3 + 2</div>
        <div class="translation" id="hintText">Pista: suma enteros (signos + y -)</div>

        <!-- ‚úÖ Ahora se generan autom√°ticamente y se parecen al ejercicio -->
        <p class="example-en"><span class="label">Ejemplo resuelto:</span> <span id="example1">-5 + 2 = -3</span></p>
        <p class="example-es"><span class="label">Otro ejemplo:</span> <span id="example2">8 - 11 = -3</span></p>

        <p class="question" id="question">¬øCu√°l es el resultado?</p>

        <div class="options" id="optionsContainer"></div>
        <div class="feedback" id="feedback"></div>
      </div>

      <div class="controls">
        <button class="main-btn" onclick="nextLesson()">Siguiente</button>
        <button class="main-btn" onclick="shareApp()">üì§ Compartir app</button>
      </div>
    </section>

  </div>

  <!-- Sonidos -->
  <audio id="sound-correct" src="correct.mp3" preload="auto"></audio>
  <audio id="sound-wrong" src="wrong.mp3" preload="auto"></audio>
  <audio id="sound-levelup" src="levelup.mp3" preload="auto"></audio>

  <script>
    function goHome() { location.href = "index.html"; }
  </script>

  <script>
    // ====== SUMA ALGEBRAICA (ENTEROS) ======
    const quizConfig = {
      min: -12,
      max: 12,
      avoidZeroBoth: true,
      maxProgress: 10,
      optionsCount: 3
    };

    let currentExercise = null;
    let correctCount = 0;
    let wrongCount = 0;
    let answeredCorrectly = false;

    let progress = 0;
    const maxProgress = quizConfig.maxProgress;

    const correctSpan = document.getElementById("xpValue");
    const wrongSpan = document.getElementById("heartsValue");
    const feedbackEl = document.getElementById("feedback");
    const lessonCard = document.getElementById("lessonCard");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");

    const soundCorrect = document.getElementById("sound-correct");
    const soundWrong = document.getElementById("sound-wrong");
    const soundLevelup = document.getElementById("sound-levelup");

    function updateProgressBar() {
      const percent = (progress / maxProgress) * 100;
      progressBar.style.width = percent + "%";
      progressText.textContent = `${progress}/${maxProgress}`;
    }

    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function formatOperation(a, b) {
      if (b >= 0) return `${a} + ${b}`;
      return `${a} - ${Math.abs(b)}`;
    }

    function compute(a, b) { return a + b; }

    function pickEmoji(a, b) {
      if (a < 0 && b < 0) return "‚ûñ";
      if (a >= 0 && b >= 0) return "‚ûï";
      return "‚ûï‚ûñ";
    }

    // ‚úÖ Genera un ejemplo resuelto "parecido" al ejercicio:
    // - mismo rango (min/max)
    // - misma "idea" (si el ejercicio es suma con negativo/positivo, el ejemplo tambi√©n)
    // - mismo formato de operaci√≥n (a + b / a - b)
    function generateSimilarExampleLike(ex) {
      const a0 = ex.a;
      const b0 = ex.b;

      // Clasificar tipo del ejercicio actual:
      const type =
        (a0 >= 0 && b0 >= 0) ? "PP" :
        (a0 < 0 && b0 < 0) ? "NN" :
        "MIX";

      let a = 0, b = 0;

      // Intentamos varias veces para que quede "similar" y no igual
      for (let tries = 0; tries < 50; tries++) {
        a = randInt(quizConfig.min, quizConfig.max);
        b = randInt(quizConfig.min, quizConfig.max);

        if (quizConfig.avoidZeroBoth && a === 0 && b === 0) continue;
        if (a === a0 && b === b0) continue; // no igual al ejercicio

        if (type === "PP" && (a >= 0 && b >= 0)) break;
        if (type === "NN" && (a < 0 && b < 0)) break;
        if (type === "MIX" && !((a >= 0 && b >= 0) || (a < 0 && b < 0))) break;
      }

      const ans = compute(a, b);
      return {
        a, b, ans,
        opText: formatOperation(a, b)
      };
    }

    function generateExercise() {
      let a = randInt(quizConfig.min, quizConfig.max);
      let b = randInt(quizConfig.min, quizConfig.max);

      if (quizConfig.avoidZeroBoth) {
        while (a === 0 && b === 0) {
          a = randInt(quizConfig.min, quizConfig.max);
          b = randInt(quizConfig.min, quizConfig.max);
        }
      }

      const ans = compute(a, b);

      const distractors = new Set();
      const candidates = [
        ans + 1, ans - 1, ans + 2, ans - 2,
        a - b, b - a,
        -ans
      ];

      shuffleArray(candidates);
      for (const c of candidates) {
        if (distractors.size >= (quizConfig.optionsCount - 1)) break;
        if (c !== ans) distractors.add(c);
      }

      while (distractors.size < (quizConfig.optionsCount - 1)) {
        const c = ans + randInt(-6, 6);
        if (c !== ans) distractors.add(c);
      }

      const options = [ans, ...Array.from(distractors)];
      shuffleArray(options);

      return {
        a, b, ans,
        emoji: pickEmoji(a, b),
        operationText: formatOperation(a, b),
        options
      };
    }

    function renderLesson() {
      answeredCorrectly = false;
      currentExercise = generateExercise();

      document.getElementById("emoji").textContent = currentExercise.emoji;
      document.getElementById("operationText").textContent = currentExercise.operationText;

      // ‚úÖ Ejemplos resueltos parecidos al ejercicio
      const ex1 = generateSimilarExampleLike(currentExercise);
      const ex2 = generateSimilarExampleLike(currentExercise);

      document.getElementById("example1").textContent = `${ex1.opText} = ${ex1.ans}`;
      document.getElementById("example2").textContent = `${ex2.opText} = ${ex2.ans}`;

      feedbackEl.textContent = "";
      feedbackEl.classList.remove("good", "bad");
      lessonCard.classList.remove("correct", "wrong");

      createOptions();
    }

    function createOptions() {
      const container = document.getElementById("optionsContainer");
      container.innerHTML = "";

      currentExercise.options.forEach(optionValue => {
        const btn = document.createElement("button");
        btn.textContent = optionValue;
        btn.className = "option-btn";
        btn.onclick = () => checkAnswer(optionValue, btn);
        container.appendChild(btn);
      });
    }

    function speakTextEs(text) {
      if (!("speechSynthesis" in window)) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "es-ES";
      utter.rate = 0.95;
      utter.pitch = 1.02;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function speakOperation() {
      if (!currentExercise) return;

      const a = currentExercise.a;
      const b = currentExercise.b;

      const aTxt = (a < 0) ? `menos ${Math.abs(a)}` : `${a}`;
      const opTxt = (b >= 0) ? "m√°s" : "menos";
      const bTxt = `${Math.abs(b)}`;

      speakTextEs(`${aTxt} ${opTxt} ${bTxt}`);
    }

    function playSound(audioElement) {
      if (!audioElement) return;
      audioElement.currentTime = 0;
      audioElement.play().catch(() => { });
    }

    function checkAnswer(answer, clickedBtn) {
      if (!currentExercise) return;
      if (answeredCorrectly) return;

      if (answer === currentExercise.ans) {
        answeredCorrectly = true;

        correctCount++;
        correctSpan.textContent = correctCount;

        if (progress < maxProgress) {
          progress += 1;
          updateProgressBar();
        }

        const goodMsgs = ["‚úÖ ¬°Muy bien!", "‚úÖ ¬°Correcto!", "‚úÖ ¬°Excelente!", "‚úÖ ¬°Buen trabajo!"];
        feedbackEl.textContent = goodMsgs[Math.floor(Math.random() * goodMsgs.length)];
        feedbackEl.classList.remove("bad");
        feedbackEl.classList.add("good");

        playSound(soundCorrect);
        speakTextEs("¬°Correcto!");

        lessonCard.classList.remove("wrong");
        lessonCard.classList.add("correct");

        document.querySelectorAll(".option-btn").forEach(b => { b.disabled = true; });

        if (correctCount > 0 && correctCount % 5 === 0) playSound(soundLevelup);

        if (progress >= maxProgress) {
          feedbackEl.textContent = "üéâ ¬°Lecci√≥n completa! Sigue practicando.";
          feedbackEl.classList.add("good");
          playSound(soundLevelup);
          speakTextEs("¬°Lecci√≥n completa! Sigue practicando.");
        }
      } else {
        wrongCount++;
        wrongSpan.textContent = wrongCount;

        feedbackEl.textContent = `‚ùå A√∫n no. Intenta otra vez.`;
        feedbackEl.classList.remove("good");
        feedbackEl.classList.add("bad");

        playSound(soundWrong);
        speakTextEs("A√∫n no. Intenta otra vez.");

        lessonCard.classList.remove("correct");
        lessonCard.classList.add("wrong");

        if (clickedBtn) clickedBtn.disabled = true;
      }
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function nextLesson() { renderLesson(); }

    updateProgressBar();
    renderLesson();
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js").catch(() => { });
      });
    }
  </script>

  <script>
    function shareApp() {
      const shareData = {
        title: "Mini Cursos",
        text: "üìö Practica suma algebraica (enteros) con esta app educativa",
        url: window.location.href
      };

      if (navigator.share) {
        navigator.share(shareData).catch(() => { });
      } else {
        navigator.clipboard.writeText(shareData.url);
        alert("üîó Link copiado para compartir");
      }
    }
  </script>

</body>
</html>
